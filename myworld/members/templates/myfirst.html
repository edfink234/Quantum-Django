{% load static %}
<!DOCTYPE HTML>
<html lang="en">
<html>

<link rel="stylesheet" href="{% static 'myfirst.css' %}">

<head>
  <meta charset="utf-8">
      <link rel="shortcut icon" href="#" />
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
          <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
              <!--  <title>Quantum Django</title>-->
              <title>RedTrap</title>
</head>
<body>
 
  <h1> Quantum Django! </h1>
<br/>

<div class="container-fluid pt-1 pl-1" style="height:50px">
  <div class="d-flex align-items-center flex-wrap">
    <button class="btn btn-primary" onclick="openNav()">
      &#9776
    </button>

    <div class="d-flex">
      <h3 class="pl-1 d-flex px-2">Red Trap</h3>
    </div>
    <div class="d-flex container justify-content-between">
      <div class="d-flex align-items-center">
        <div class="px-2">
          <div class="progress" style="width:100px">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
              QFDR
            </div>
          </div>
        </div>

        <div class="px-2">
          <div class="progress" style="width:100px">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            Branching
            </div>
          </div>
        </div>

        <div class="px-2">
          <div class="progress" style="width:100px">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              Autocalibration
            </div>
          </div>
        </div>
      </div>
    

      <div class="d-flex alert-success p-1 rounded border border-primary">
        <p class="text-white"></p>Autocalibration</p>
      </div>

      <div class="d-flex alert-success p-1 rounded border border-primary">
        Status: Executing Seq1
      </div>
    </div>

  </div>
</div>

<div class="container-fluid pt-1 pl-1">
    
    
  <img src={% static "Camera_Dummy.jpg" %} alt="Camera Dummy">
  <img src= {% static "Pmt_Dummy.jpg" %} alt="Pmt Dummy">
</div>

<div id="mySidenav" class="sidenav">
<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
<a href="{% url 'Detection' %}">Detection</a>
<a href="#">Quadrupole</a>
<a href="#">Raman</a>
<nobr><a href="{% url 'Motor_Control' %}">Motor Control</a></nobr>
<nobr><a href="#">Static Control</a></nobr>
<nobr><a href="{% url 'Bertha_Channels' %}">Bertha Channels</a></nobr>
</div>

<script>
function openNav() {
  document.getElementById("mySidenav").style.width = "250px";
}

function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
}
</script>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  {% autoescape off %}
<br/>
<br/>
<a href="{% url 'data' %}" type="button" style="background-color: navy; color: white; padding: 5px 10px;" >Open Data</a>
 <br/>
 <br/>
  {% endautoescape %}

  <h3>What chat room would you like to enter?</h3><br>
    <input id="room-name-input" type="text" size="100"><br>
    <input id="room-name-submit" type="button" value="Enter">

        <br/>
        <br/>
        <br/>
        

<textarea id="csv-log" cols="100" rows="20" readonly></textarea><br>
        
<form id="myForm">
<input type="file" id="csvFile" accept=".csv" />
<br />
<input type="submit" value="Submit" />
</form>
<script>
const myForm = document.getElementById("myForm");
const csvFile = document.getElementById("csvFile");
myForm.addEventListener("submit", function (e) {
    e.preventDefault();
    const input = csvFile.files[0];
    const reader = new FileReader();
    var text;
    reader.onload = function (e)
    {
        var count = 0;
        var text = e.target.result.split("\n");
        var numLines = text.length;

        var chatSocket = new WebSocket(
                    'ws://'
                    + window.location.host
                    + '/ws/members/'
                );

        chatSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
            };

        chatSocket.onmessage = function(e) {
               const data = JSON.parse(e.data);
                //alert(data.message[0]);
                    var my_plot = {
                    z : data.message,
                    type: 'heatmap'
                   // opacity: 0.8,
                };
                Plotly.newPlot('heat-map', [my_plot]);
                    
                };

        var myfunc = setInterval(function()
        {
            line = text[count++ % numLines].split(",").splice(2);
            for (let i = 0; i<line.length; i++)
            {
                //document.querySelector('#csv-log').value += parseFloat(line[i]) + '\n';
                line[i] = parseFloat(line[i]);
                
            }
            newArr = [];
            while(line.length) newArr.push(line.splice(0,11));
               

            chatSocket.send(JSON.stringify({
                        'text_data': newArr
                    }));
        }, 500);

    };
        reader.readAsText(input);
});
</script>
<div id="heat-map"> </div>

<script language="javascript">
    document.querySelector('#room-name-input').focus();
        document.querySelector('#room-name-input').onkeyup = function(e) {
            if (e.keyCode === 13) {  // enter, return
                document.querySelector('#room-name-submit').click();
            }
        };

        document.querySelector('#room-name-submit').onclick = function(e) {
            var roomName = document.querySelector('#room-name-input').value;
            window.location.pathname = '/members/' + roomName + '/';
        };
</script>

</body>
</html>
